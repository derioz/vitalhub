(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,92050,e=>{"use strict";e.i(36180);var s=e.i(98925),t=e.i(59141);e.s(["UserService",0,{createUser:async(e,r)=>{let a=(0,s.doc)(t.db,"users",e);await (0,s.setDoc)(a,{...r,id:e,createdAt:(0,s.serverTimestamp)(),lastLoginAt:(0,s.serverTimestamp)(),status:"ACTIVE",roles:r.roles||["role_vital_member"]},{merge:!0})},getUser:async e=>{let r=(0,s.doc)(t.db,"users",e),a=await (0,s.getDoc)(r);return a.exists()?{id:a.id,...a.data()}:null},getAllUsers:async()=>{let e=(0,s.query)((0,s.collection)(t.db,"users"),(0,s.orderBy)("createdAt","desc"));return(await (0,s.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}))},getRoles:async()=>{let e=(0,s.query)((0,s.collection)(t.db,"roles"),(0,s.orderBy)("order","asc"));return(await (0,s.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}))},updateUserRoles:async(e,r)=>{let a=(0,s.doc)(t.db,"users",e);await (0,s.updateDoc)(a,{roles:r})},updateProfile:async(e,r)=>{let a=(0,s.doc)(t.db,"users",e);await (0,s.setDoc)(a,r,{merge:!0})},getStaffMembers:async()=>{let e=(0,s.query)((0,s.collection)(t.db,"users")),r=await (0,s.getDocs)(e),a=["role_support","role_sr_support","role_mod","role_sr_mod","role_admin","role_head_admin","role_owner","role_developer"];return r.docs.map(e=>({id:e.id,...e.data()})).filter(e=>e.roles?.some(e=>a.includes(e)))}}])},8745,e=>{"use strict";var s=e.i(18050),t=e.i(71645),r=e.i(18566),a=e.i(43412),l=e.i(18753),i=e.i(92050),d=e.i(96412),o=e.i(76098),c=e.i(94913),n=e.i(1851),x=e.i(18789),b=e.i(71689),m=e.i(3116),u=e.i(84614),p=e.i(79002),g=e.i(43034),h=e.i(73884),f=e.i(95468),N=e.i(16715),j=e.i(78894),v=e.i(87316),w=e.i(88081),y=e.i(86311),k=e.i(22016),T=e.i(75157);let S=[{value:"OPEN",label:"Open",color:"bg-green-500"},{value:"IN_PROGRESS",label:"In Progress",color:"bg-blue-500"},{value:"WAITING_ON_USER",label:"Waiting on User",color:"bg-yellow-500"},{value:"RESOLVED",label:"Resolved",color:"bg-purple-500"},{value:"CLOSED",label:"Closed",color:"bg-slate-500"}],C=[{value:"URGENT",label:"ðŸ”´ Urgent",color:"text-red-400"},{value:"HIGH",label:"ðŸŸ  High",color:"text-orange-400"},{value:"NORMAL",label:"ðŸ”µ Normal",color:"text-blue-400"},{value:"LOW",label:"ðŸŸ¢ Low",color:"text-green-400"}];function U({id:e}){var U,A;let E,R,_=(0,r.useRouter)(),{user:O,userData:D}=(0,a.useAuth)(),[L,I]=(0,t.useState)(null),[G,P]=(0,t.useState)([]),[M,H]=(0,t.useState)(!0),[B,F]=(0,t.useState)(!1),W=["role_admin","role_head_admin","role_owner","role_developer"],q=(D?.roles||[]).some(e=>W.includes(e));(0,t.useEffect)(()=>{V()},[e]);let V=async()=>{H(!0);try{let s=await l.TicketService.getTicket(e);if(s&&!s.authorName&&s.authorId){let e=await i.UserService.getUser(s.authorId);e?.name&&(s.authorName=e.name,l.TicketService.updateTicketMetadata(s.id,{authorName:s.authorName}))}if(I(s),q){let e=await i.UserService.getStaffMembers();P(e)}}catch(e){console.error(e)}finally{H(!1)}},K=async e=>{if(L){F(!0);try{await l.TicketService.updateStatus(L.id,e),I(s=>s?{...s,status:e}:null)}catch(e){console.error(e),alert("Failed to update status")}finally{F(!1)}}},X=async e=>{if(L){F(!0);try{await l.TicketService.escalateTicket(L.id,e),I(s=>s?{...s,priority:e}:null)}catch(e){console.error(e),alert("Failed to update priority")}finally{F(!1)}}},J=async()=>{if(L&&O&&D){F(!0);try{await l.TicketService.assignTicket(L.id,O.uid,D.name||"Staff"),I(e=>e?{...e,assignedTo:O.uid,assignedToName:D.name||"Staff",status:"IN_PROGRESS"}:null)}catch(e){console.error(e),alert("Failed to assign ticket")}finally{F(!1)}}},Q=async e=>{if(!L)return;let s=G.find(s=>s.id===e),t=s?.name||s?.username||"Staff Member";F(!0);try{await l.TicketService.assignTicket(L.id,e,t),I(s=>s?{...s,assignedTo:e,assignedToName:t,status:"IN_PROGRESS"}:null)}catch(e){console.error(e),alert("Failed to assign ticket")}finally{F(!1)}};if(M)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,s.jsx)("div",{className:"animate-spin h-8 w-8 border-2 border-[#f97316] border-t-transparent rounded-full"})});if(!L)return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center",children:[(0,s.jsx)(h.XCircle,{className:"h-16 w-16 text-red-500 mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"Ticket Not Found"}),(0,s.jsx)("p",{className:"text-[#8b949e] mb-4",children:"The ticket you're looking for doesn't exist or has been deleted."}),(0,s.jsxs)(k.default,{href:"/dashboard/tickets",className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-[#21262d] text-white hover:bg-[#30363d] transition-colors",children:[(0,s.jsx)(b.ArrowLeft,{className:"h-4 w-4"}),"Back to Tickets"]})]});let Y=(0,o.getCategoryConfig)(L.category);return(0,s.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("button",{onClick:()=>_.push("/dashboard/tickets"),className:"p-2 rounded-lg hover:bg-[#21262d] text-[#8b949e] hover:text-white transition-colors mt-1",children:(0,s.jsx)(b.ArrowLeft,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1 text-sm font-mono text-[#8b949e]",children:[(0,s.jsx)(w.Hash,{className:"h-4 w-4"}),L.ticketId]}),(0,s.jsx)("span",{className:(0,T.cn)("px-2.5 py-1 rounded-full text-xs font-medium border",(U=L.status,(E={OPEN:"bg-green-500/10 text-green-400 border-green-500/30",IN_PROGRESS:"bg-blue-500/10 text-blue-400 border-blue-500/30",WAITING_ON_USER:"bg-yellow-500/10 text-yellow-400 border-yellow-500/30",RESOLVED:"bg-purple-500/10 text-purple-400 border-purple-500/30",CLOSED:"bg-slate-500/10 text-slate-400 border-slate-500/30"})[U]||E.CLOSED)),children:L.status.replace(/_/g," ")}),(0,s.jsxs)("span",{className:(0,T.cn)("px-2.5 py-1 rounded-full text-xs font-medium border",(A=L.priority,(R={URGENT:"bg-red-500/10 text-red-400 border-red-500/30",HIGH:"bg-orange-500/10 text-orange-400 border-orange-500/30",NORMAL:"bg-blue-500/10 text-blue-400 border-blue-500/30",LOW:"bg-gray-500/10 text-gray-400 border-gray-500/30"})[A]||R.NORMAL)),children:["URGENT"===L.priority&&(0,s.jsx)(j.AlertTriangle,{className:"h-3 w-3 inline mr-1"}),L.priority]})]}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-white tracking-tight",children:L.subject}),(0,s.jsxs)("p",{className:"text-[#8b949e] text-sm mt-1",children:["Created by ",(0,s.jsx)("span",{className:"text-[#58a6ff]",children:L.authorName||L.authorEmail})," â€¢ ",L.createdAt?.seconds?(0,c.formatDistanceToNow)(new Date(1e3*L.createdAt.seconds),{addSuffix:!0}):"Just now"]})]}),(0,s.jsx)("button",{onClick:V,disabled:B,className:"p-2 rounded-lg border border-[#30363d] text-[#8b949e] hover:text-white hover:bg-[#21262d] transition-colors",children:(0,s.jsx)(N.RefreshCw,{className:(0,T.cn)("h-4 w-4",B&&"animate-spin")})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsxs)("div",{className:"rounded-xl border border-[#30363d] bg-[#0d1117] overflow-hidden",children:[(0,s.jsx)("div",{className:"px-5 py-3 border-b border-[#21262d] bg-[#161b22]",children:(0,s.jsxs)("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[(0,s.jsx)(y.MessageSquare,{className:"h-4 w-4 text-[#f97316]"}),"Description"]})}),(0,s.jsx)("div",{className:"p-5 prose prose-invert prose-sm max-w-none text-[#e6edf3] break-words",children:(0,s.jsx)(x.default,{children:L.description||"No description provided."})})]}),(0,s.jsx)(d.TicketChat,{ticketId:L.id})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"rounded-xl border border-[#30363d] bg-[#0d1117] overflow-hidden",children:[(0,s.jsx)("div",{className:"px-5 py-3 border-b border-[#21262d] bg-[#161b22]",children:(0,s.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Quick Actions"})}),(0,s.jsxs)("div",{className:"p-4 space-y-2",children:[(0,s.jsxs)("button",{onClick:J,disabled:B||L.assignedTo===O?.uid,className:"w-full flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium bg-blue-500/10 text-blue-400 hover:bg-blue-500/20 transition-colors disabled:opacity-50",children:[(0,s.jsx)(p.UserPlus,{className:"h-4 w-4"}),L.assignedTo===O?.uid?"Assigned to You":"Assign to Me"]}),(0,s.jsxs)("button",{onClick:()=>X("URGENT"),disabled:B||"URGENT"===L.priority,className:"w-full flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium bg-orange-500/10 text-orange-400 hover:bg-orange-500/20 transition-colors disabled:opacity-50",children:[(0,s.jsx)(g.ArrowUpCircle,{className:"h-4 w-4"}),"Escalate to Urgent"]}),"CLOSED"!==L.status?(0,s.jsxs)("button",{onClick:()=>K("CLOSED"),disabled:B,className:"w-full flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors disabled:opacity-50",children:[(0,s.jsx)(h.XCircle,{className:"h-4 w-4"}),"Close Ticket"]}):(0,s.jsxs)("button",{onClick:()=>K("OPEN"),disabled:B,className:"w-full flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium bg-green-500/10 text-green-400 hover:bg-green-500/20 transition-colors disabled:opacity-50",children:[(0,s.jsx)(f.CheckCircle2,{className:"h-4 w-4"}),"Reopen Ticket"]})]})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-[#30363d] bg-[#0d1117] overflow-hidden",children:[(0,s.jsx)("div",{className:"px-5 py-3 border-b border-[#21262d] bg-[#161b22]",children:(0,s.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Details"})}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[10px] font-medium text-[#8b949e] uppercase tracking-wider mb-1.5 block",children:"Status"}),(0,s.jsx)("select",{value:L.status,onChange:e=>K(e.target.value),disabled:B,className:"w-full px-3 py-2 text-sm rounded-lg border border-[#30363d] bg-[#161b22] text-white focus:outline-none focus:border-[#f97316] disabled:opacity-50",children:S.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[10px] font-medium text-[#8b949e] uppercase tracking-wider mb-1.5 block",children:"Priority"}),(0,s.jsx)("select",{value:L.priority,onChange:e=>X(e.target.value),disabled:B,className:"w-full px-3 py-2 text-sm rounded-lg border border-[#30363d] bg-[#161b22] text-white focus:outline-none focus:border-[#f97316] disabled:opacity-50",children:C.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[10px] font-medium text-[#8b949e] uppercase tracking-wider mb-1.5 block",children:"Category"}),(0,s.jsxs)("div",{className:(0,T.cn)("px-3 py-2 rounded-lg border text-sm",Y.bgColor,Y.color,Y.borderColor),children:[Y.emoji," ",Y.label]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[10px] font-medium text-[#8b949e] uppercase tracking-wider mb-1.5 block",children:"Assignee"}),q?(0,s.jsxs)("select",{value:L.assignedTo||"",onChange:e=>Q(e.target.value),disabled:B,className:"w-full px-3 py-2 text-sm rounded-lg border border-[#30363d] bg-[#161b22] text-white focus:outline-none focus:border-[#f97316] disabled:opacity-50",children:[(0,s.jsx)("option",{value:"",children:"Unassigned"}),G.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name||e.username||"Unknown Staff"},e.id))]}):(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border border-[#30363d] bg-[#161b22]",children:[(0,s.jsx)(u.User,{className:"h-4 w-4 text-[#8b949e]"}),(0,s.jsx)("span",{className:L.assignedToName?"text-blue-400":"text-[#484f58] italic",children:L.assignedToName||"Unassigned"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[10px] font-medium text-[#8b949e] uppercase tracking-wider mb-1.5 block",children:"Author"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border border-[#30363d] bg-[#161b22]",children:[(0,s.jsx)(u.User,{className:"h-4 w-4 text-[#8b949e]"}),(0,s.jsx)("span",{className:"text-[#e6edf3]",children:L.authorName||L.authorEmail})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[10px] font-medium text-[#8b949e] uppercase tracking-wider mb-1.5 block",children:"Created"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border border-[#30363d] bg-[#161b22]",children:[(0,s.jsx)(v.Calendar,{className:"h-4 w-4 text-[#8b949e]"}),(0,s.jsx)("span",{className:"text-[#e6edf3] text-sm",children:L.createdAt?.seconds?(0,n.format)(new Date(1e3*L.createdAt.seconds),"MMM d, yyyy h:mm a"):"Unknown"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[10px] font-medium text-[#8b949e] uppercase tracking-wider mb-1.5 block",children:"Last Updated"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border border-[#30363d] bg-[#161b22]",children:[(0,s.jsx)(m.Clock,{className:"h-4 w-4 text-[#8b949e]"}),(0,s.jsx)("span",{className:"text-[#e6edf3] text-sm",children:L.updatedAt?.seconds?(0,c.formatDistanceToNow)(new Date(1e3*L.updatedAt.seconds),{addSuffix:!0}):"Unknown"})]})]})]})]})]})]})]})}e.s(["TicketDetailClient",()=>U])}]);